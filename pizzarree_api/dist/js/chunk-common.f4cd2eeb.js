"use strict";(globalThis["webpackChunkpizzarree"]=globalThis["webpackChunkpizzarree"]||[]).push([[64],{9524:(e,t,s)=>{s.d(t,{M:()=>i});s(2879);var a=s(1809),r=s(1569),n=s(6827),l=s(6928);const i=(0,a.Q_)("shop",{state:()=>({products:{pizzas:{},toppings:{},drinks:{},deserts:{},sides:{},sizes:{},crusts:{}},cart:{},checkout:{},order:{},customer_email:null}),persist:{beforeRestore:e=>{},key:"shop"},getters:{getCart:e=>e.cart,getCartItemsCount:e=>{let t=0;return Object.values(e.cart).forEach((e=>{t+=e?.quantity||0})),t},hasCurrentPendingOrder:e=>Object.keys(e.order).length>0&&Object.hasOwnProperty(e.order,"id"),AuthUser:e=>{const t=(0,l.t)();return t},flatCartProducts:e=>Object.values(e.cart).flatMap((({items:e,quantity:t})=>({items:e,quantity:t}))).map((({items:e,quantity:t})=>Object.values(e).flat().map((e=>[{id:e.id,quantity:t}])))).flat().flatMap((e=>e))},actions:{async clearCart(){this.cart={},this.order={},await this.router.push({name:"Done",query:{message:"Order Successful",level:"success"}})},async serverCartSanityCheck(){let e=await r.api.get("api/v1/shop/cart/details/"),t=e.data.cart.flatMap((e=>({id:e.product.id,quantity:e.quantity})));const s=JSON.stringify(this.flatCartProducts.sort())===JSON.stringify(t.sort()),a=0!==Object.keys(e.data).length;return a&&!s&&await r.api.post("api/v1/shop/cart/clear/"),s},async postToApiCart(e,t="api/v1/shop/cart/add/"){r.api.defaults.withCredentials=!0;let s=await this.serverCartSanityCheck();s?await this.router.push({name:"Checkout"}):await r.api.post(t,e).then((async e=>{await this.createOrUpdateOrder()})).catch((e=>n.Z.create({type:"negative",message:e.response?.data?.detail,closeBtn:!0})))},async getCartApi(e){r.api.defaults.withCredentials=!0,await r.api.get(e).then((e=>console.log(e))).catch((e=>n.Z.create({type:"negative",message:e.response.data.detail,closeBtn:!0})))},async createOrUpdateOrder(e=!0){let t,s;r.api.defaults.withCredentials=!0,this.hasCurrentPendingOrder?(t=`api/v1/shop/orders/${this.order.id}/`,s="put"):(t="api/v1/shop/orders/",s="post"),await r.api[s](t,{email:this.customer_email}).then((async({data:t})=>{Object.assign(this.order,t),e&&await this.router.push({name:"Checkout"})})).catch((e=>{console.log(e.message),n.Z.create({type:"negative",message:e.message,closeBtn:!0})}))},async addToLocalCart(e,t){const s=e=>JSON.stringify(Object.values(e));let a=!1,r=e;for(const n in this.cart)s(this.cart[n].items.flat().sort())===s(t.sort())&&(a=!0,r=n);a?this.cart[r].quantity+=1:this.cart[r]={items:[t],quantity:1}},async retrieveProducts(e="api/v1/shop/products"){let t=await r.api.get(e),s=t.data.results;this.products.drinks=s.filter((e=>e.tags.includes("drink"))),this.products.pizzas=s.filter((e=>e.tags.includes("pizza"))),this.products.deserts=s.filter((e=>e.tags.includes("desert"))),this.products.toppings=s.filter((e=>e.tags.includes("topping"))),this.products.sides=s.filter((e=>e.tags.includes("side"))),this.products.sizes=s.filter((e=>e.tags.includes("size"))),this.products.crusts=s.filter((e=>e.tags.includes("crust")))},async setupCustomerOrderEmail(){this.AuthUser.isAuthenticated?this.customer_email=this.AuthUser.authUser.email:null==this.customer_email&&(this.customer_email=Date.now()+"_guest@test.net")}}})},6501:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});class a{constructor(){this.errors={}}has(e){return Object.prototype.hasOwnProperty.call(this.errors,e)}any(){return Object.keys(this.errors).length>0}get(e){if(this.errors[e])return this.errors[e][0]}record(e){Object.assign(this.errors,e)}clear(e){e?delete this.errors[e]:this.errors={}}}const r=a;var n=s(1569);class l{constructor(e){this.originalData=e;for(let t in e)this[t]=e[t];this.errors=new r}data(){let e={};for(let t in this.originalData)e[t]=this[t];return e}reset(){for(let e in this.originalData)this[e]="";this.errors.clear()}post(e){return this.submit("post",e)}put(e){return this.submit("put",e)}patch(e){return this.submit("patch",e)}delete(e){return this.submit("delete",e)}submit(e,t){return this.errors.clear(),new Promise(((s,a)=>{n.api[e](t,this.data()).then((e=>{this.onSuccess(),s(e.data),this.onFinished()})).catch((e=>{e.response?(this.onFail(e.response.data),a(e.response.data)):(this.onFail(e.message),a(e.message)),this.onFinished()}))}))}onSuccess(){this.reset()}onFail(e){this.errors.record(e)}onFinished(){}commonErrors(){let e=!0;for(let t in this.originalData)this.errors.has(t)&&(e=!1);return this.errors.any()&&e}}const i=l},2888:(e,t,s)=>{s.d(t,{Z:()=>g});var a=s(9835),r=s(6970);function n(e,t,s,n,l,i){const o=(0,a.up)("q-icon"),c=(0,a.up)("q-item-section"),u=(0,a.up)("q-item-label"),d=(0,a.up)("q-item"),p=(0,a.Q2)("ripple");return(0,a.wy)(((0,a.wg)(),(0,a.j4)(d,{clickable:"",to:{name:e.link},exact:"","active-class":"text-secondary"},{default:(0,a.w5)((()=>[e.icon?((0,a.wg)(),(0,a.j4)(c,{key:0,avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(o,{name:e.icon},null,8,["name"])])),_:1})):(0,a.kq)("",!0),(0,a.Wm)(c,{dense:""},{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,r.zw)(e.title),1)])),_:1}),(0,a.Wm)(u,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,r.zw)(e.caption),1)])),_:1})])),_:1})])),_:1},8,["to"])),[[p]])}const l=(0,a.aZ)({name:"EssentialLink",props:{title:{type:String,required:!0},caption:{type:String,default:""},link:{type:String,default:"#"},icon:{type:String,default:""}}});var i=s(1639),o=s(490),c=s(6749),u=s(2857),d=s(3115),p=s(1136),m=s(9984),h=s.n(m);const w=(0,i.Z)(l,[["render",n]]),g=w;h()(l,"components",{QItem:o.Z,QItemSection:c.Z,QIcon:u.Z,QItemLabel:d.Z}),h()(l,"directives",{Ripple:p.Z})},4487:(e,t,s)=>{s.d(t,{Z:()=>h});var a=s(9835);const r=["innerHTML"];function n(e,t,s,n,l,i){const o=(0,a.up)("q-btn"),c=(0,a.up)("q-banner");return Object.keys(s.errors.errors).length&&!n.dismissed?((0,a.wg)(),(0,a.j4)(c,{key:0,"inline-actions":"",rounded:"",class:"text-white bg-red"},{action:(0,a.w5)((()=>[(0,a.Wm)(o,{flat:"",label:e.$t("dismiss"),onClick:t[0]||(t[0]=e=>n.dismissed=!0)},null,8,["label"])])),default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.errors.errors,((e,t)=>((0,a.wg)(),(0,a.iD)("span",{key:t,innerHTML:e},null,8,r)))),128))])),_:1})):(0,a.kq)("",!0)}var l=s(499);const i={name:"FormErrors",props:["errors"],setup(){const e=(0,l.ref)(!1);return{dismissed:e}}};var o=s(1639),c=s(7128),u=s(4455),d=s(9984),p=s.n(d);const m=(0,o.Z)(i,[["render",n]]),h=m;p()(i,"components",{QBanner:c.Z,QBtn:u.Z})},6402:(e,t,s)=>{s.d(t,{Z:()=>f});var a=s(9835),r=s(1957),n=s(6970);const l=(0,a._)("div",{class:"tw-flex tw-items-center tw-justify-center tw-max-w-full tw-min-h-full tw-col-span-5 tw-text-center"},[(0,a._)("div",{class:"tw-animate-spin tw-rounded-full tw-h-32 tw-w-32 tw-border-t-0 tw-border-b-3 tw-border-yellow-300 tw-z-10 tw-border-solid"})],-1);function i(e,t,s,i,o,c){const u=(0,a.up)("q-icon"),d=(0,a.up)("q-btn"),p=(0,a.up)("q-banner");return i.error?(0,a.WI)(e.$slots,"error",{key:0},(()=>[(0,a.Wm)(p,{rounded:"",class:"bg-red-7 text-white tw-max-w-md tw-mt-1 tw-m-auto"},{avatar:(0,a.w5)((()=>[(0,a.Wm)(u,{name:"warning",color:""})])),action:(0,a.w5)((()=>[(0,a.Wm)(d,{flat:"",color:"",label:"Dismiss",onClick:t[0]||(t[0]=(0,r.iM)((e=>i.error=null),["prevent"]))})])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(i.error)+" ",1)])),_:1})])):((0,a.wg)(),(0,a.j4)(a.n4,{key:1},{default:(0,a.w5)((()=>[(0,a.WI)(e.$slots,"default")])),fallback:(0,a.w5)((()=>[(0,a.WI)(e.$slots,"fallback",{},(()=>[l]))])),_:3}))}var o=s(499);const c={name:"SuspenseWithErrors",setup(){const e=(0,o.ref)(null);return(0,a.d1)((({message:t})=>(e.value=t,!0))),{error:e}}};var u=s(1639),d=s(7128),p=s(2857),m=s(4455),h=s(9984),w=s.n(h);const g=(0,u.Z)(c,[["render",i]]),f=g;w()(c,"components",{QBanner:d.Z,QIcon:p.Z,QBtn:m.Z})},7615:(e,t,s)=>{s.d(t,{Z:()=>q});var a=s(9835),r=s(6970);const n={class:"text-center q-pb-lg"},l={key:0,class:"tw-font-extrabold tw-text-xl tw-underline tw-underline-offset-[0.78rem] tw-my-4"},i={class:"column tw-max-h-6 q-pt-sm"},o={class:"justify-between row tw-mx-6"},c={class:"justify-around row"};function u(e,t,s,u,d,p){const m=(0,a.up)("q-linear-progress"),h=(0,a.up)("FormErrors"),w=(0,a.up)("q-card-section"),g=(0,a.up)("q-card"),f=(0,a.up)("q-btn"),v=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(v,{class:"content-center justify-center tw-h-full tw-w-full column"},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{class:"column tw-min-w-[440px] tw-min-h-[440px] q-pa-lg",rounded:""},{default:(0,a.w5)((()=>[s.loading?((0,a.wg)(),(0,a.j4)(m,{key:0,indeterminate:"",color:"primary",class:"absolute-top"})):(0,a.kq)("",!0),(0,a._)("div",n,[s.actionText.length?((0,a.wg)(),(0,a.iD)("div",l,(0,r.zw)(u.capitalize(e.$t(s.actionText))),1)):(0,a.kq)("",!0)]),s.form&&s.form.commonErrors()?((0,a.wg)(),(0,a.j4)(h,{key:1,errors:s.form.errors},null,8,["errors"])):(0,a.kq)("",!0),(0,a.Wm)(w,{class:"col"},{default:(0,a.w5)((()=>[(0,a.WI)(e.$slots,"default")])),_:3})])),_:3}),(0,a._)("div",i,[(0,a._)("div",o,[(0,a._)("div",c,[(0,a.Wm)(f,{label:u.capitalize(e.$t("terms_of_service")),dense:"","no-caps":"",flat:"",unelevated:""},null,8,["label"])])])])])),_:3})}var d=s(321),p=s(4487);const m={name:"UserAccessCard",components:{FormErrors:p.Z},props:{form:{type:Object,default:()=>{}},loading:{type:Boolean,default:!1},actionText:{type:String,default:""}},setup(){const{capitalize:e}=d["default"];return{capitalize:e}}};var h=s(1639),w=s(9885),g=s(4458),f=s(8289),v=s(3190),y=s(4455),b=s(9984),k=s.n(b);const _=(0,h.Z)(m,[["render",u]]),q=_;k()(m,"components",{QPage:w.Z,QCard:g.Z,QLinearProgress:f.Z,QCardSection:v.Z,QBtn:y.Z})},6002:(e,t,s)=>{s.d(t,{Z:()=>B});var a=s(9835),r=s(6970),n=s(1957);const l=["src"],i={class:"text-weight-bold"},o={key:0},c=(0,a._)("p",{class:"tw-font-medium"},"Size:",-1),u={class:"q-gutter-sm"},d=(0,a._)("p",{class:"tw-font-medium"},"Crust:",-1),p={class:"q-gutter-sm"},m=(0,a._)("p",{class:"tw-font-medium"},"Toppings:",-1),h={class:"q-gutter-sm flex column"},w={key:0},g=["textContent"];function f(e,t,s,f,v,y){const b=(0,a.up)("q-avatar"),k=(0,a.up)("q-toolbar-title"),_=(0,a.up)("q-toolbar"),q=(0,a.up)("q-icon"),C=(0,a.up)("q-radio"),Z=(0,a.up)("q-card-section"),z=(0,a.up)("q-checkbox"),j=(0,a.up)("q-card"),x=(0,a.up)("q-btn"),W=(0,a.up)("q-card-actions"),O=(0,a.up)("q-dialog"),S=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(O,{"model-value":e.modelValue,"onUpdate:modelValue":e.handleModelChanged,onBeforeShow:e.handleBeforeShow,persistent:e.editing},{default:(0,a.w5)((()=>[e.currentPassedProduct?((0,a.wg)(),(0,a.j4)(j,{key:0,class:"tw-min-w-[70%] tw-min-h-full row tw-static"},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{class:"left col-md-8 col-xs-12"},{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a.Wm)(b,null,{default:(0,a.w5)((()=>[(0,a._)("img",{src:e.currentPassedProduct.cover_image},null,8,l)])),_:1}),(0,a.Wm)(k,null,{default:(0,a.w5)((()=>[(0,a._)("span",i,(0,r.zw)(e.currentPassedProduct.name),1)])),_:1})])),_:1}),e.currentPassedProduct.tags?.includes("pizza")?((0,a.wg)(),(0,a.iD)("div",o,[(0,a.Wm)(Z,{class:"flex items-stretch align-center column"},{default:(0,a.w5)((()=>[c,(0,a._)("div",u,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.shopStore.products.sizes,(s=>((0,a.wg)(),(0,a.j4)(C,{modelValue:e.selectedSize,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedSize=t),key:s.name,val:s,label:s.name},{default:(0,a.w5)((()=>[s.cover_image?((0,a.wg)(),(0,a.j4)(q,{key:0,name:"img:"+s.cover_image},null,8,["name"])):(0,a.kq)("",!0),(0,a._)("span",null,"$"+(0,r.zw)(s.price),1)])),_:2},1032,["modelValue","val","label"])))),128))])])),_:1}),(0,a.Wm)(Z,{class:"flex items-stretch align-center column"},{default:(0,a.w5)((()=>[d,(0,a._)("div",p,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.shopStore.products.crusts,(s=>((0,a.wg)(),(0,a.j4)(C,{modelValue:e.selectedCrust,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedCrust=t),val:s,label:s.name,name:s.name,key:s.id},{default:(0,a.w5)((()=>[(0,a.Wm)(q,{name:"img:"+s.cover_image},null,8,["name"]),(0,a._)("span",null,"$"+(0,r.zw)(s.price),1)])),_:2},1032,["modelValue","val","label","name"])))),128))])])),_:1}),(0,a.Wm)(Z,{class:"flex items-stretch align-center column"},{default:(0,a.w5)((()=>[m,(0,a._)("div",h,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.shopStore.products.toppings,(s=>((0,a.wg)(),(0,a.j4)(z,{modelValue:e.selectedToppings,"onUpdate:modelValue":t[2]||(t[2]=t=>e.selectedToppings=t),key:s.name,val:s,label:s.name},{default:(0,a.w5)((()=>[(0,a.Wm)(q,{name:"img:"+s.cover_image,class:"tw-h-20 tw-w-20"},null,8,["name"]),(0,a._)("span",null,"$"+(0,r.zw)(s.price),1)])),_:2},1032,["modelValue","val","label"])))),128))])])),_:1})])):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(j,{class:"tw-bg-gray-500 col-md-4 col-xs-12 tw-sticky tw-top-0 self-start"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{align:"between"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,null,{default:(0,a.w5)((()=>[(0,a.Uk)("My Pizza")])),_:1}),(0,a.wy)(((0,a.wg)(),(0,a.j4)(x,{flat:"",round:"",dense:"",stack:"",icon:"close"},{default:(0,a.w5)((()=>[(0,a.Uk)("Discard")])),_:1})),[[S]])])),_:1}),(0,a.Wm)(Z,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.myPizza,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t},[t?.id?((0,a.wg)(),(0,a.iD)("span",w,[(0,a._)("span",{textContent:(0,r.zw)(t?.name)},null,8,g),t?.tags?.includes("topping")?((0,a.wg)(),(0,a.j4)(x,{key:0,flat:"",dense:"",stack:"",icon:"remove",onClick:(0,n.iM)((s=>e.clearTopping(t?.name)),["prevent"])},null,8,["onClick"])):(0,a.kq)("",!0)])):(0,a.kq)("",!0)])))),128))])),_:1}),(0,a.Wm)(W,null,{default:(0,a.w5)((()=>[(0,a.Wm)(x,{class:"glossy",dense:"",color:"secondary",icon:"add",label:e.actionText,onClick:e.addToOrder},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0)])),_:1},8,["model-value","onUpdate:modelValue","onBeforeShow","persistent"])}s(2879),s(9766);var v=s(499),y=s(9524),b=s(9302);const k=(0,a.aZ)({name:"ProductModal",props:{product:{type:Object,default:()=>{}},showModal:{type:Boolean,default:!1,required:!1},modelValue:{type:Boolean,default:!1},editing:{type:Boolean,default:!1},editingItems:{type:Object,default:()=>{},required:!1},actionText:{type:String,default:"Add to cart"}},emits:["hideModal","update:model-value"],setup(e,{emit:t}){const s=(0,y.M)(),r=(0,b.Z)();let n=(0,v.ref)([]),l=(0,v.ref)(null),i=(0,v.ref)(null),o=(0,v.ref)([]),c=(0,v.ref)({}),u=(0,v.ref)(null);const d=e=>{t("hideModal",e)};function p(e){let t=n.value.findIndex((t=>t.name===e));n.value.splice(t,1);let s=o.value.findIndex((t=>t?.name===e));o.value.splice(s,1)}async function m(){let a=(!l.value||!i.value)&&c.value?.tags?.includes("pizza");if(a)return void r.notify({type:"warning",message:"You need to select size and crust.",progress:!0});let n=u.value?u.value:e.product.tags[0]+"_"+(Math.random()+1).toString(36).substring(7);await s.addToLocalCart(n,o.value),r.notify({type:"positive",message:e.actionText,progress:!0}),t("hideModal",!1)}function h(){if(e.editing&&1===Object.keys(e.editingItems).length){u.value=Object.keys(e.editingItems)[0],c.value=Object.values(e.editingItems)[0][0];let t=[];Object.values(e.editingItems).flat().forEach((e=>{e.tags.includes("topping")?t.push(s.products.toppings.filter((t=>t.id===e.id))[0]):e.tags.includes("crust")?i.value=s.products.crusts.filter((t=>t.id===e.id))[0]:e.tags.includes("size")&&(l.value=s.products.sizes.filter((t=>t.id===e.id))[0])})),n.value=[...new Set(t)]}else c.value=e.product;o.value=[c.value]}return(0,a.YP)([l,i,n],(e=>{o.value=e.flat(),o.value.unshift(c.value)})),{handleModelChanged:d,selectedToppings:n,selectedSize:l,selectedCrust:i,myPizza:o,clearTopping:p,shopStore:s,addToOrder:m,handleBeforeShow:h,currentPassedProduct:c,currentPassedId:u}}});var _=s(1639),q=s(2074),C=s(4458),Z=s(1663),z=s(1357),j=s(1973),x=s(3190),W=s(1480),O=s(2857),S=s(1221),P=s(1821),Q=s(4455),T=s(2146),D=s(9984),I=s.n(D);const M=(0,_.Z)(k,[["render",f]]),B=M;I()(k,"components",{QDialog:q.Z,QCard:C.Z,QToolbar:Z.Z,QAvatar:z.Z,QToolbarTitle:j.Z,QCardSection:x.Z,QRadio:W.Z,QIcon:O.Z,QCheckbox:S.Z,QCardActions:P.Z,QBtn:Q.Z}),I()(k,"directives",{ClosePopup:T.Z})},3407:(e,t,s)=>{s.r(t),s.d(t,{default:()=>p});var a=s(9835);function r(e,t,s,r,n,l){const i=(0,a.up)("CheckoutComponent"),o=(0,a.up)("SuspenseWithErrors"),c=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(c,{class:"flex justify-center"},{default:(0,a.w5)((()=>[(0,a.Wm)(o,null,{default:(0,a.w5)((()=>[(0,a.Wm)(i)])),_:1})])),_:1})}var n=s(6402);const l=(0,a.aZ)({name:"CheckoutPage",components:{SuspenseWithErrors:n.Z,CheckoutComponent:(0,a.RC)((()=>Promise.all([s.e(736),s.e(64),s.e(620)]).then(s.bind(s,7620))))}});var i=s(1639),o=s(9885),c=s(9984),u=s.n(c);const d=(0,i.Z)(l,[["render",r]]),p=d;u()(l,"components",{QPage:o.Z})}}]);